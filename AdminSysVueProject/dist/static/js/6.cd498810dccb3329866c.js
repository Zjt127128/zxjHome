webpackJsonp([6],{"0keR":function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={name:"updateProduct",components:{ComboDetail:o("Aa6X").a}},l={render:function(){var e=this.$createElement;return(this._self._c||e)("combo-detail",{attrs:{"is-edit":!0}})},staticRenderFns:[]};var i=o("VU/8")(a,l,!1,function(e){o("AuSi")},null,null);t.default=i.exports},Aa6X:function(e,t,o){"use strict";var a=o("mvHQ"),l=o.n(a),i=o("woOf"),n=o.n(i),s=o("1oEH"),r=o("/1c3"),c={id:null,name:null,price:0,classificationIds:[],discount:{type:null,val:null,count:-1},tag:null,comboDish:[]},u={name:"comboDish",props:{isEdit:{type:Boolean,default:!1}},data:function(){return{loading:!1,selectDialogVisible:!1,dialogSelectRow:null,cs:["yyds"],dialogData:{list:null,total:null,listQuery:{keyword:null,pageNum:1,pageSize:8}},rules:{name:[{required:!0,message:"请输入套餐名称",trigger:"blur"},{min:1,max:20,message:"长度为 1 到 20 个字符",trigger:"blur"}]},form:n()({},c)}},created:function(){var e=this;this.getClassificationList(),this.isEdit&&Object(s.e)(this.$route.query.id).then(function(t){console.log(t.data);var o="";t.data.tags.forEach(function(e){return o+=e.replace(",","")+" "}),null==t.data.discount&&(t.data.discount={type:0,val:null,count:0}),t.data.comboDish.forEach(function(e){return e.flag=!0}),t.data.tag=o,e.form=t.data,console.log("this.form = ",e.form)}).catch(function(e){console.log(e)})},methods:{test:function(){console.log("ee",this.form.discount)},getClassificationList:function(){var e=this;Object(r.b)().then(function(t){var o=t.data.arrays.filter(function(e){return e.id>=1e5});e.cs=o,console.log("cs == ",l()(e.cs))}).catch(function(e){console.log("获取Cshivering"+e)})},handleAdd:function(){this.selectDialogVisible=!0,this.dialogData.listQuery.keyword=null,this.getDialogList(),this.selectDialogVisible=!0},getDialogList:function(){var e=this;Object(r.c)(this.dialogData.listQuery).then(function(t){console.log("调用成功"),e.dialogData.list=t.data.arrays,e.dialogData.total=t.data.total})},handleSelectDialogConfirm:function(){var e=this;this.dialogSelectRow?this.$confirm("确定选择?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.form.comboDish.unshift({dishId:e.dialogSelectRow.id,dishName:e.dialogSelectRow.name,dishPrice:e.dialogSelectRow.price}),e.selectDialogVisible=!1,e.dialogSelectRow=null,console.log("确定",e.form)}):this.$message({message:"请选择一条记录",type:"warning",duration:1e3})},numChange:function(){console.log("roworow");var e=this.form.comboDish,t=0;console.log(e,"lilili"),e.forEach(function(e){t+=e.dishPrice*e.dishNum}),this.form.price=t},handleSelectSearch:function(){this.getDialogList()},handleDialogSizeChange:function(e){this.dialogData.listQuery.pageNum=1,this.dialogData.listQuery.pageSize=e,this.getDialogList()},handleDialogCurrentChange:function(e){this.dialogData.listQuery.pageNum=e,this.getDialogList()},rowClick:function(e,t,o){console.log("点击事件触发"+o,e),this.dialogSelectRow=e},tableRowClassNameOfDialog:function(e){var t=e.row;e.rowIndex;return this.dialogSelectRow&&t.id===this.dialogSelectRow.id?"success-row":""},handleSelect:function(e,t){this.form.price+=5*t.dishNum,t.success=!0,t.update=!1,this.comboDish.unshift({dishId:null,dishName:null,dishNum:null,success:!1,update:!1})},handleUpdate:function(e,t){t.update=!1},handleDelete:function(e,t){var o=this;this.$confirm("此操作将删除该项, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){console.log("没？？"),t.flag?(o.loading=!0,Object(s.b)(t).then(function(t){o.loading=!1,o.form.comboDish.splice(e,1),o.$message({duration:3e3,type:"info",message:"成功删除"}),o.numChange()}).catch(function(e){o.$message({duration:3e3,type:"info",message:"网络出错"}),o.loading=!1})):(o.form.comboDish.splice(e,1),o.$message({duration:1500,type:"success",message:"删除成功!"}),o.numChange())}).catch(function(){o.$message({duration:3e3,type:"info",message:"已取消删除"})})},handleCurrentChange:function(e){this.currentRow=e},tableRowClassName:function(e){var t=e.row;e.rowIndex;return t.success?"success-row":""},finishCommit:function(e){var t=this;this.numChange(),console.log(e),console.log("this.form ===== ",this.form),this.$refs[e].validate(function(e){if(console.log(e),!e)return console.log("error submit!!"),alert("您填写的表单有误，请重新填写"),!1;var o=t.isEdit;t.form.tags=null==t.form.tag?[]:t.form.tag.split("\\s+"),console.log("this.form == ",t.form),t.$confirm("是否要提交该产品","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){o?Object(s.f)(t.form).then(function(e){t.$message({type:"success",message:"提交成功",duration:1e3}),t.$router.back()}):Object(s.a)(t.form).then(function(e){t.$message({type:"success",message:"提交成功",duration:1e3}),location.reload()})})})}}},d={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-card",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"form-container",attrs:{shadow:"never"}},[o("span",{staticClass:"title"},[e._v("填写套餐表单: ")]),e._v(" "),o("el-form",{ref:"form",staticClass:"form",attrs:{model:e.form,rules:e.rules,"label-width":"80px"}},[o("el-form-item",{attrs:{"label-width":"100px",label:"套餐名称:",prop:"name"}},[o("el-input",{model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),o("el-form-item",{attrs:{"label-width":"100px",label:"具体配置:",prop:"detail"}},[o("el-button",{attrs:{size:"mini"},on:{click:function(t){e.handleAdd()}}},[e._v("选择添加")]),e._v(" "),o("el-table",{staticStyle:{width:"100%"},attrs:{"highlight-current-row":"",data:e.form.comboDish,height:"350",border:"","row-class-name":e.tableRowClassName},on:{"current-change":e.handleCurrentChange}},[o("el-table-column",{attrs:{prop:"dishId",label:"菜品编号",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-input",{attrs:{disabled:""},model:{value:t.row.dishId,callback:function(o){e.$set(t.row,"dishId",o)},expression:"scope.row.dishId"}})]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"dishName",label:"菜品名称",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-input",{attrs:{disabled:""},model:{value:t.row.dishName,callback:function(o){e.$set(t.row,"dishName",o)},expression:"scope.row.dishName"}})]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"dishNum",label:"菜品数量"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-input",{on:{input:function(e){t.row.update=!0},change:e.numChange},model:{value:t.row.dishNum,callback:function(o){e.$set(t.row,"dishNum",o)},expression:"scope.row.dishNum"}})]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("p",[o("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(o){e.handleDelete(t.$index,t.row)}}},[e._v("移除")])],1)]}}])})],1)],1),e._v(" "),o("el-form-item",{attrs:{"label-width":"100px",label:"套餐单价:",prop:"price"}},[o("el-input",{attrs:{disabled:"",placeholder:"请填写套餐具体配置"},model:{value:e.form.price,callback:function(t){e.$set(e.form,"price",e._n(t))},expression:"form.price"}})],1),e._v(" "),o("el-form-item",{attrs:{"label-width":"100px",label:"套餐分类:",prop:"kind"}},[o("el-checkbox-group",{model:{value:e.form.classificationIds,callback:function(t){e.$set(e.form,"classificationIds",t)},expression:"form.classificationIds"}},e._l(e.cs,function(t){return o("el-checkbox",{key:t.id,attrs:{label:t.id}},[e._v(e._s(t.name))])}))],1),e._v(" "),o("el-form-item",{attrs:{"label-width":"100px",label:"套餐标签:",prop:"tags"}},[o("el-input",{attrs:{type:"textarea",rows:3,placeholder:"多个标签请以空格或换行分隔，如：养生菜 下酒菜 适合小孩子吃"},model:{value:e.form.tag,callback:function(t){e.$set(e.form,"tag",t)},expression:"form.tag"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"优惠方式: ","label-width":"100px"}},[o("el-radio-group",{attrs:{size:"medium"},on:{change:e.test},model:{value:e.form.discount.type,callback:function(t){e.$set(e.form.discount,"type",t)},expression:"form.discount.type"}},[o("el-radio-button",{attrs:{border:"",label:"0"}},[e._v("无优惠")]),e._v(" "),o("el-radio-button",{attrs:{border:"",label:"1"}},[e._v("折扣优惠")]),e._v(" "),o("el-radio-button",{attrs:{border:"",label:"2"}},[e._v("立减优惠")])],1)],1),e._v(" "),0!==e.form.discount.type?o("el-form-item",{attrs:{label:"优惠力度: ","label-width":"100px"}},[1==e.form.discount.type?o("el-input",{attrs:{placeholder:"请输入折扣力度，输入应为一个 0 ~ 10 之间的数，例如输入 9 表示九折"},model:{value:e.form.discount.val,callback:function(t){e.$set(e.form.discount,"val",e._n(t))},expression:"form.discount.val"}}):e._e(),e._v(" "),2==e.form.discount.type?o("el-input",{attrs:{placeholder:"请输入立减价格，输入应为一个整数或小数，单位为元"},model:{value:e.form.discount.val,callback:function(t){e.$set(e.form.discount,"val",t)},expression:"form.discount.val"}}):e._e(),e._v(" "),o("span",{staticStyle:{color:"red"}},[e._v("注：套餐作为长期营销手段，应当长期稳定提供优惠，不应设置限制")])],1):e._e(),e._v(" "),o("el-form-item",{staticStyle:{"margin-left":"20px"}},[o("el-button",{attrs:{type:"primary"},on:{click:function(t){e.finishCommit("form")}}},[e._v("立即创建")]),e._v(" "),o("el-button",[e._v("取消")])],1)],1),e._v(" "),o("el-dialog",{attrs:{title:"选择菜品",visible:e.selectDialogVisible,width:"50%"},on:{"update:visible":function(t){e.selectDialogVisible=t}}},[o("el-input",{staticStyle:{width:"250px","margin-bottom":"20px"},attrs:{size:"small",placeholder:"菜品名称搜索"},model:{value:e.dialogData.listQuery.keyword,callback:function(t){e.$set(e.dialogData.listQuery,"keyword",t)},expression:"dialogData.listQuery.keyword"}},[o("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:function(t){e.handleSelectSearch()}},slot:"append"})],1),e._v(" "),o("el-table",{attrs:{data:e.dialogData.list,"row-class-name":e.tableRowClassNameOfDialog,border:""},on:{"row-click":e.rowClick}},[o("el-table-column",{attrs:{label:"菜品ID",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.id))]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"菜品名称",width:"160",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.name))]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"菜品价格",width:"160",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("￥"+e._s(t.row.price))]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"菜品类型",width:"160",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.id>=1e5?"套餐":"菜品"))]}}])})],1),e._v(" "),o("div",{staticClass:"pagination-container"},[o("el-pagination",{attrs:{background:"",layout:"prev, pager, next","current-page":e.dialogData.listQuery.pageNum,"page-size":e.dialogData.listQuery.pageSize,"page-sizes":[5,10,15],total:e.dialogData.total},on:{"size-change":e.handleDialogSizeChange,"current-change":e.handleDialogCurrentChange,"update:currentPage":function(t){e.$set(e.dialogData.listQuery,"pageNum",t)}}})],1),e._v(" "),o("div",{staticStyle:{clear:"both"}}),e._v(" "),o("div",{attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{size:"small"},on:{click:function(t){e.selectDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){e.handleSelectDialogConfirm()}}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var f=o("VU/8")(u,d,!1,function(e){o("F040")},null,null);t.a=f.exports},AuSi:function(e,t){},F040:function(e,t){}});
//# sourceMappingURL=6.cd498810dccb3329866c.js.map